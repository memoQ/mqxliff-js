!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("xml-js")):"function"==typeof define&&define.amd?define(["xml-js"],t):e.mqxliff=t(e.xmlJs)}(this,function(s){"use strict";var w,e,t,n;function u(e){return{bold:void 0!==e&&e.bold,italic:void 0!==e&&e.italic,underlined:void 0!==e&&e.underlined,subscript:void 0!==e&&e.subscript,superscript:void 0!==e&&e.superscript,content:[]}}function o(e){e.startsWith("</")&&(e="<"+e.substring(2)),e.endsWith("/>")&&(e=e.substring(0,e.length-2)+">");var t=s.xml2js(e),n={name:t.elements[0].name,attrs:new Array},r=t.elements[0].attributes;for(var i in r)r.hasOwnProperty(i)&&n.attrs.push({attr:i,val:r[i]});return n}function i(e){for(var t=new Array,n=u(),r={},i=0;i!=e.length;++i){var s=e[i];if("text"==s.type)n.content.push({type:w.Text,text:s.text});else if("bpt"==s.name&&s.attributes.ctype)t.push(n),n=u(n),"bold"==s.attributes.ctype?(n.bold=!0,r[s.attributes.id]="bold"):"italic"==s.attributes.ctype?(n.italic=!0,r[s.attributes.id]="italic"):"underlined"==s.attributes.ctype?(n.underlined=!0,r[s.attributes.id]="underlined"):"x-sub"==s.attributes.ctype?(n.subscript=!0,r[s.attributes.id]="subscript"):"x-sup"==s.attributes.ctype&&(n.superscript=!0,r[s.attributes.id]="superscript");else if("bpt"==s.name){(l=o(s.elements[0].text)).type=w.OpenTag,n.content.push(l)}else if("ept"==s.name)if("{}"==s.elements[0].text){t.push(n),n=u(n);var a=r[s.attributes.id];"bold"==a?n.bold=!1:"italic"==a?n.italic=!1:"underlined"==a?n.underlined=!1:"subscript"==a?n.subscript=!1:"superscript"==a&&(n.superscript=!1)}else{(l=o(s.elements[0].text)).type=w.CloseTag,n.content.push(l)}else if("ph"==s.name){var l;(l=o(s.elements[0].text)).type=w.EmptyTag,n.content.push(l)}else"x"==s.name&&n.content.push({type:w.StructuralTag})}return 0<n.content.length&&t.push(n),t}function C(e,t,n,r){return{attributes:void 0!==n&&n,name:void 0!==e&&e,type:void 0!==t&&t,elements:void 0===r?new Array({text:"{}",type:"text"}):new Array({text:r,type:"text"})}}function a(e){for(var t=new Array,n=!1,r=0,i=!1,s=0,a=!1,l=0,u=!1,o=0,p=!1,m=0,c=1,d=new Array,f=0;f<e.length;f++){if(e[f].bold&&0==n){n=!0;var g={ctype:"bold",id:c.toString()};r=c,t.push(C("bpt","element",g)),c++}if(e[f].italic){i=!0;g={ctype:"italic",id:c.toString()};s=c,t.push(C("bpt","element",g)),c++}if(e[f].subscript){a=!0;g={ctype:"x-sub",id:c.toString()};l=c,t.push(C("bpt","element",g)),c++}if(e[f].superscript){u=!0;g={ctype:"x-sup",id:c.toString()};o=c,t.push(C("bpt","element",g)),c++}if(e[f].underlined){p=!0;g={ctype:"underlined",id:c.toString()};m=c,t.push(C("bpt","element",g)),c++}if(!1===e[f].bold&&!0===n){n=!1;var b={id:r.toString()};t.push(C("ept","element",b))}if(!1===e[f].italic&&!0===i){i=!1;b={id:s.toString()};t.push(C("ept","element",b))}if(!1===e[f].subscript&&!0===a){a=!1;b={id:l.toString()};t.push(C("ept","element",b))}if(!1===e[f].superscript&&!0===u){u=!1;b={id:o.toString()};t.push(C("ept","element",b))}if(!1===e[f].underlined&&!0===p){p=!1;b={id:m.toString()};t.push(C("ept","element",b))}for(var h=0;e[f].content.length>h;h++){if(e[f].content[h].type===w.OpenTag){d.push(c);var y={id:c.toString()};c++;var v="<"+e[f].content[h].name;if(void 0!==(S=e[f].content[h].attrs))for(var x=0;S.length>x;x++)v+=" "+S[x].attr+'="'+S[x].val+'"';v+=">",t.push(C("bpt","element",y,v))}if(e[f].content[h].type===w.EmptyTag){y={id:c.toString()};c++;v="<"+e[f].content[h].name;if(void 0!==(S=e[f].content[h].attrs))for(x=0;S.length>x;x++)v+=" "+S[x].attr+'="'+S[x].val+'"';v+="/>",t.push(C("ph","element",y,v))}if(e[f].content[h].type===w.CloseTag){var T={id:d.pop().toString()};v="</"+e[f].content[h].name;if(void 0!==(S=e[f].content[h].attrs))for(x=0;S.length>x;x++)v+=" "+S[x].attr+'="'+S[x].val+'"';v+=">",t.push(C("ept","element",T,v))}if(e[f].content[h].type===w.StructuralTag){y={id:c.toString()};c++;var S=e[f].content[h].attrs;t.push(C("x","element",y))}e[f].content[h].type===w.Text&&t.push(e[f].content[h])}}return t}function l(e){for(var t="",n=0;n!=e.length;++n){var r=e[n];"text"==r.type&&(t+=r.text)}return t}function r(t){for(var n,e=t.elements[0].elements[0],r=0;r!=e.elements.length;++r)"body"==e.elements[r].name&&(n=e.elements[r].elements);return{info:function(){var e=t.elements[0].elements[0];return{srcLang:e.attributes["source-language"],trgLang:e.attributes["target-language"],docName:e.attributes.original,tuCount:n.length}},getTU:function(e){return r=n[e],{status:function(){return r.attributes["mq:status"]},matchRate:function(){return r.attributes["mq:percent"]?1*r.attributes["mq:percent"]:0},srcPlain:function(e){for(var t,n=0;n!=r.elements.length;++n)if("source"==r.elements[n].name){t=r.elements[n];break}if(void 0===e)for(n=0;n!=r.elements.length;++n)return l(t.elements);else"string"==typeof e&&(t.elements=[{type:"text",text:e}])},trgPlain:function(e){for(var t,n=0;n!=r.elements.length;++n)if("target"==r.elements[n].name){t=r.elements[n];break}if(void 0===e)for(n=0;n!=r.elements.length;++n)return l(t.elements);else"string"==typeof e&&(t.elements=[{type:"text",text:e}])},srcRich:function(e){if(void 0===e){for(var t=0;t!=r.elements.length;++t)if("source"==r.elements[t].name)return i(r.elements[t].elements)}else for(t=0;t!=r.elements.length;++t)"source"==r.elements[t].name&&(r.elements[t].elements=a(e))},trgRich:function(e){if(void 0===e){for(var t=0;t!=r.elements.length;++t)if("target"==r.elements[t].name)return i(r.elements[t].elements)}else for(t=0;t!=r.elements.length;++t)"target"==r.elements[t].name&&(r.elements[t].elements=a(e))}};var r},writeXliff:function(){return s.js2xml(t,{compact:!1})},writeJson:function(){return JSON.stringify(t,null,2)}}}return(e=w||(w={})).Text="text",e.StructuralTag="StructuralTag",e.OpenTag="OpenTag",e.EmptyTag="EmptyTag",e.CloseTag="CloseTag",(n=t||(t={})).NotStarted="NotStarted",n.PreTranslated="PreTranslated",n.PartiallyEdited="PartiallyEdited",n.ManuallyConfirmed="ManuallyConfirmed",n.Reviewer1Confirmed="Reviewer1Confirmed",n.AssembledFromFragments="AssembledFromFragments",n.Proofread="Proofread",n.MachineTranslated="MachineTranslated",n.Rejected="Rejected",function(e){return r(s.xml2js(e,{compact:!1,alwaysChildren:!0,ignoreComment:!0}))}});
