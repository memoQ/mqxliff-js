!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("xml-js")):"function"==typeof define&&define.amd?define(["xml-js"],t):e.mqxliff=t(e.xmlJs)}(this,function(i){"use strict";var a,e,t,n;function u(e){return{bold:void 0!==e&&e.bold,italic:void 0!==e&&e.italic,underlined:void 0!==e&&e.underlined,subscript:void 0!==e&&e.subscript,superscript:void 0!==e&&e.superscript,content:[]}}function m(e){e.startsWith("</")&&(e="<"+e.substring(2)),e.endsWith("/>")&&(e=e.substring(0,e.length-2)+">");var t=i.xml2js(e),n={name:t.elements[0].name,attrs:new Array},r=t.elements[0].attributes;for(var s in r)r.hasOwnProperty(s)&&n.attrs.push({attr:s,val:r[s]});return n}function s(e){console.log("elms"),console.log(e);for(var t=new Array,n=u(),r={},s=0;s!=e.length;++s){var i=e[s];if("text"==i.type)n.content.push({type:a.Text,text:i.text});else if("bpt"==i.name&&i.attributes.ctype)t.push(n),n=u(n),"bold"==i.attributes.ctype?(n.bold=!0,r[i.attributes.id]="bold"):"italic"==i.attributes.ctype?(n.italic=!0,r[i.attributes.id]="italic"):"underlined"==i.attributes.ctype?(n.underlined=!0,r[i.attributes.id]="underlined"):"x-sub"==i.attributes.ctype?(n.subscript=!0,r[i.attributes.id]="subscript"):"x-sup"==i.attributes.ctype&&(n.superscript=!0,r[i.attributes.id]="superscript");else if("bpt"==i.name){(o=m(i.elements[0].text)).type=a.OpenTag,n.content.push(o)}else if("ept"==i.name)if("{}"==i.elements[0].text){t.push(n),n=u(n);var l=r[i.attributes.id];"bold"==l?n.bold=!1:"italic"==l?n.italic=!1:"underlined"==l?n.underlined=!1:"subscript"==l?n.subscript=!1:"superscript"==l&&(n.superscript=!1)}else{(o=m(i.elements[0].text)).type=a.CloseTag,n.content.push(o)}else if("ph"==i.name){var o;(o=m(i.elements[0].text)).type=a.EmptyTag,n.content.push(o)}else"x"==i.name&&n.content.push({type:a.StructuralTag})}return 0<n.content.length&&t.push(n),t}function h(e,t,n){return{attributes:void 0!==n&&n,name:void 0!==e&&e,type:void 0!==t&&t,elements:new Array({text:"{}",type:"text"})}}function l(e){console.log("setRichText");for(var t=new Array,n=!1,r=0,s=!1,i=0,l=!1,o=0,a=!1,u=0,m=!1,c=0,p=1,d=0;d<e.length;d++){if(e[d].bold&&0==n){n=!0;var f={ctype:"bold",id:p.toString()};r=p,t.push(h("bpt","element",f)),p++}if(e[d].italic){s=!0;f={ctype:"italic",id:p.toString()};i=p,t.push(h("bpt","element",f)),p++}if(e[d].subscript){l=!0;f={ctype:"x-sub",id:p.toString()};o=p,t.push(h("bpt","element",f)),p++}if(e[d].superscript){a=!0;f={ctype:"x-sup",id:p.toString()};u=p,t.push(h("bpt","element",f)),p++}if(e[d].underlined){m=!0;f={ctype:"underlined",id:p.toString()};c=p,t.push(h("bpt","element",f)),p++}if(!1===e[d].bold&&!0===n){console.log("add bold!!!! "+r),n=!1;var g={id:r.toString()};t.push(h("ept","element",g))}if(!1===e[d].italic&&!0===s){s=!1;g={id:i.toString()};t.push(h("ept","element",g))}if(!1===e[d].subscript&&!0===l){l=!1;g={id:o.toString()};t.push(h("ept","element",g))}if(!1===e[d].superscript&&!0===a){a=!1;g={id:u.toString()};t.push(h("ept","element",g))}if(!1===e[d].underlined&&!0===m){m=!1;g={id:c.toString()};t.push(h("ept","element",g))}for(var b=0;e[d].content.length>b;b++)t.push(e[d].content[b])}return t}function o(e){for(var t="",n=0;n!=e.length;++n){var r=e[n];"text"==r.type&&(t+=r.text)}return t}function r(t){for(var n,e=t.elements[0].elements[0],r=0;r!=e.elements.length;++r)"body"==e.elements[r].name&&(n=e.elements[r].elements);return{info:function(){var e=t.elements[0].elements[0];return{srcLang:e.attributes["source-language"],trgLang:e.attributes["target-language"],docName:e.attributes.original,tuCount:n.length}},getTU:function(e){return r=n[e],{status:function(){return r.attributes["mq:status"]},matchRate:function(){return r.attributes["mq:percent"]?1*r.attributes["mq:percent"]:0},srcPlain:function(e){for(var t,n=0;n!=r.elements.length;++n)if("source"==r.elements[n].name){t=r.elements[n];break}if(void 0===e)for(n=0;n!=r.elements.length;++n)return o(t.elements);else"string"==typeof e&&(t.elements=[{type:"text",text:e}])},trgPlain:function(e){for(var t,n=0;n!=r.elements.length;++n)if("target"==r.elements[n].name){t=r.elements[n];break}if(void 0===e)for(n=0;n!=r.elements.length;++n)return o(t.elements);else"string"==typeof e&&(t.elements=[{type:"text",text:e}])},srcRich:function(e){if(void 0===e){for(var t=0;t!=r.elements.length;++t)if("source"==r.elements[t].name)return s(r.elements[t].elements)}else for(t=0;t!=r.elements.length;++t)"source"==r.elements[t].name&&(console.log("before changes"),console.log(r.elements[t].elements),r.elements[t].elements=l(e),console.log("after changes"),console.log(r.elements[t].elements))},trgRich:function(e){if(void 0===e){for(var t=0;t!=r.elements.length;++t)if("target"==r.elements[t].name)return s(r.elements[t].elements)}else for(t=0;t!=r.elements.length;++t)"target"==r.elements[t].name&&(console.log(r.elements[t].elements),r.elements[t].elements=l(e))}};var r},writeXliff:function(){return i.js2xml(t,{compact:!1})},writeJson:function(){return JSON.stringify(t,null,2)}}}return(e=a||(a={})).Text="text",e.StructuralTag="StructuralTag",e.OpenTag="OpenTag",e.EmptyTag="EmptyTag",e.CloseTag="CloseTag",(n=t||(t={})).NotStarted="NotStarted",n.PreTranslated="PreTranslated",n.PartiallyEdited="PartiallyEdited",n.ManuallyConfirmed="ManuallyConfirmed",n.Reviewer1Confirmed="Reviewer1Confirmed",n.AssembledFromFragments="AssembledFromFragments",n.Proofread="Proofread",n.MachineTranslated="MachineTranslated",n.Rejected="Rejected",function(e){return r(i.xml2js(e,{compact:!1,alwaysChildren:!0,ignoreComment:!0}))}});
