!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("xml-js")):"function"==typeof define&&define.amd?define(["xml-js"],t):e.mqxliff=t(e.xmlJs)}(this,function(i){"use strict";var u,e,t,n;function o(e){return{bold:void 0!==e&&e.bold,italic:void 0!==e&&e.italic,underlined:void 0!==e&&e.underlined,subscript:void 0!==e&&e.subscript,superscript:void 0!==e&&e.superscript,content:[]}}function c(e){e.startsWith("</")&&(e="<"+e.substring(2)),e.endsWith("/>")&&(e=e.substring(0,e.length-2)+">");var t=i.xml2js(e),n={name:t.elements[0].name,attrs:new Array},r=t.elements[0].attributes;for(var s in r)r.hasOwnProperty(s)&&n.attrs.push({attr:s,val:r[s]});return n}function s(e){for(var t=new Array,n=o(),r={},s=0;s!=e.length;++s){var i=e[s];if("text"==i.type)n.content.push({type:u.Text,text:i.text});else if("bpt"==i.name&&i.attributes.ctype)t.push(n),n=o(n),"bold"==i.attributes.ctype?(n.bold=!0,r[i.attributes.id]="bold"):"italic"==i.attributes.ctype?(n.italic=!0,r[i.attributes.id]="italic"):"underlined"==i.attributes.ctype?(n.underlined=!0,r[i.attributes.id]="underlined"):"x-sub"==i.attributes.ctype?(n.subscript=!0,r[i.attributes.id]="subscript"):"x-sup"==i.attributes.ctype&&(n.superscript=!0,r[i.attributes.id]="superscript");else if("bpt"==i.name){(l=c(i.elements[0].text)).type=u.OpenTag,n.content.push(l)}else if("ept"==i.name)if("{}"==i.elements[0].text){t.push(n),n=o(n);var a=r[i.attributes.id];"bold"==a?n.bold=!1:"italic"==a?n.italic=!1:"underlined"==a?n.underlined=!1:"subscript"==a?n.subscript=!1:"superscript"==a&&(n.superscript=!1)}else{(l=c(i.elements[0].text)).type=u.CloseTag,n.content.push(l)}else if("ph"==i.name){var l;(l=c(i.elements[0].text)).type=u.EmptyTag,n.content.push(l)}else"x"==i.name&&n.content.push({type:u.StructuralTag})}return 0<n.content.length&&t.push(n),t}function a(e){for(var t="",n=0;n!=e.length;++n){var r=e[n];"text"==r.type&&(t+=r.text)}return t}function r(t){for(var n,e=(this.jobj=t).elements[0].elements[0],r=0;r!=e.elements.length;++r)"body"==e.elements[r].name&&(n=e.elements[r].elements);return this.tuArr=n,{info:function(){var e=t.elements[0].elements[0];return{srcLang:e.attributes["source-language"],trgLang:e.attributes["target-language"],docName:e.attributes.original,tuCount:n.length}},getTU:function(e){return function(r){return this.jobj=r,{status:function(){return r.attributes["mq:status"]},matchRate:function(){return r.attributes["mq:percent"]?1*r.attributes["mq:percent"]:0},srcPlain:function(){for(var e=0;e!=r.elements.length;++e)if("source"==r.elements[e].name)return a(r.elements[e].elements)},trgPlain:function(e){for(var t,n=0;n!=r.elements.length;++n)if("target"==r.elements[n].name){t=r.elements[n];break}if(void 0===e)for(n=0;n!=r.elements.length;++n)return a(t.elements);else"string"==typeof e&&(t.elements=[{type:"text",text:e}])},srcRich:function(){for(var e=0;e!=r.elements.length;++e)if("source"==r.elements[e].name)return s(r.elements[e].elements)},trgRich:function(e){for(var t,n=0;n!=r.elements.length;++n)if("target"==r.elements[n].name){t=r.elements[n];break}if(void 0===e)for(n=0;n!=r.elements.length;++n)return s(t.elements)}}}(n[e])},writeXliff:function(){return i.js2xml(t,{compact:!1})},writeJson:function(){return JSON.stringify(t,null,2)}}}return(e=u||(u={})).Text="Text",e.StructuralTag="StructuralTag",e.OpenTag="OpenTag",e.EmptyTag="EmptyTag",e.CloseTag="CloseTag",(n=t||(t={})).NotStarted="NotStarted",n.PreTranslated="PreTranslated",n.PartiallyEdited="PartiallyEdited",n.ManuallyConfirmed="ManuallyConfirmed",n.Reviewer1Confirmed="Reviewer1Confirmed",n.AssembledFromFragments="AssembledFromFragments",n.Proofread="Proofread",n.MachineTranslated="MachineTranslated",n.Rejected="Rejected",function(e){return r(i.xml2js(e,{compact:!1,alwaysChildren:!0,ignoreComment:!0}))}});
